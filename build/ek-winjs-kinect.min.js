var EKjs;!function(a){"use strict";var b=function(){this.constructor&&this.constructor.apply(this,arguments)};b.extend=function(a){var b=this,c=function(){return b.apply(this,arguments)};c.extend=b.extend;var d=function(){};d.prototype=b.prototype,c.prototype=new d;for(var e in a)c.prototype[e]=a[e];return c},a.Class=b,a.VERSION="alpha_0.0.2"}(EKjs||(EKjs={}));var EKjs;!function(a){"use strict";var b=!1,c=null,d=null,e=a.Class.extend({constructor:function(){if(d=this,!b)throw"Use EKjs.Kinect.getInstance() instead of new EKjs.Kinect() to instanciate the Kinect singleton.";this.bodyFrame=new a.KinectBodyFrame,window.WindowsPreview?(this.platform=a.Kinect.PLATFORMS.WIN8,this._checkAppState()):(this.platform=a.Kinect.PLATFORMS.WEB,this._simulateKinect())},platform:"win8",bodyFrame:null,isWin8Platform:function(){return this.platform==a.Kinect.PLATFORMS.WIN8},addCanvasDebug:function(b,c,d){c||(c=!1),this._debugs[b]=new a.KinectDebug(b),this._debugs[b].onlySelected=c,this._debugs[b].disabledClear=d,this._frameDesc&&this._debugs[b].setSize(this._frameDesc.width,this._frameDesc.height),this.bodyFrame&&this.bodyFrame.setDebugs(this._debugs)},removeCanvasDebug:function(a){delete this._debugs[a]},_app:null,_activation:null,_kinect:null,_sensor:null,_frameDesc:null,_debugs:{},_autoMultiplier:1,_startKinect:function(){this._kinect=window.WindowsPreview.Kinect,this._sensor=this._kinect.KinectSensor.getDefault(),this._frameDesc=this._sensor.bodyIndexFrameSource.frameDescription,this.bodyFrame.setFrameSize(this._frameDesc.width,this._frameDesc.height),this.bodyFrame.start(this._sensor.bodyFrameSource,this._kinect.JointType,this._kinect.Body.jointCount),this._sensor.addEventListener("isavailablechanged",this._sensor_IsAvailableChanged),this._sensor.open()},_simulateKinect:function(){this.bodyFrame.startSimulate()},_checkAppState:function(){this._app=WinJS.Application,this._activation=Windows.ApplicationModel.Activation,this._app.start(),this._app.onloaded=function(){d._startKinect()},this._app.onunload=function(a){this.bodyFrame&&this.bodyFrame.close(),null!=this._sensor&&this._sensor.close()}},_sensor_IsAvailableChanged:function(b){WinJS.Resources.dispatchEvent(a.Kinect.Events.Application.AVAILABILITY,d._sensor.isAvailable)}});e.getInstance=function(){return c||(b=!0,c=new a.Kinect,b=!1),c},e.PLATFORMS={WIN8:"win8",WEB:"web"},e.Events={Application:{AVAILABILITY:"EKjs.Kinect.Events.Application.AVAILABILITY"},Pointer:{MOVE:"EKjs.Kinect.Events.Pointer.MOVE",OVER:"EKjs.Kinect.Events.Pointer.OVER",OUT:"EKjs.Kinect.Events.Pointer.OUT",DOWN:"EKjs.Kinect.Events.Pointer.DOWN",UP:"EKjs.Kinect.Events.Pointer.UP",HOLD_START:"EKjs.Kinect.Events.Pointer.HOLD_START",HOLD_PROGRESS:"EKjs.Kinect.Events.Pointer.HOLD_PROGRESS",HOLD_END:"EKjs.Kinect.Events.Pointer.HOLD_END"}},a.Kinect=e}(EKjs||(EKjs={}));var EKjs;!function(a){"use strict";var b=a.Class.extend({constructor:function(){this.pointer=new a.KinectPointer(this)},id:0,pointer:void 0,pointMultiplier:1,trackArea:{x:.5,z:1,dephX:.2,dephZ:.1,handPushZ:.2},rightHand:{x:0,y:0,z:0},leftHand:{x:0,y:0,z:0},head:{x:0,y:0,z:0},neck:{x:0,y:0,z:0},spineShoulder:{x:0,y:0,z:0},spineMid:{x:0,y:0,z:0},spineBase:{x:0,y:0,z:0},shoulderRight:{x:0,y:0,z:0},elbowRight:{x:0,y:0,z:0},wristRight:{x:0,y:0,z:0},handTipRight:{x:0,y:0,z:0},thumbRight:{x:0,y:0,z:0},shoulderLeft:{x:0,y:0,z:0},elbowLeft:{x:0,y:0,z:0},handTipLeft:{x:0,y:0,z:0},thumbLeft:{x:0,y:0,z:0},wristLeft:{x:0,y:0,z:0},hipRight:{x:0,y:0,z:0},kneeRight:{x:0,y:0,z:0},ankleRight:{x:0,y:0,z:0},footRight:{x:0,y:0,z:0},hipLeft:{x:0,y:0,z:0},kneeLeft:{x:0,y:0,z:0},ankleLeft:{x:0,y:0,z:0},footLeft:{x:0,y:0,z:0},isTracked:!1,handLeftTracked:!1,handRightTracked:!1,render:function(){this.pointer.render()},startSimulate:function(){this.pointer.startSimulate()},stopSimulate:function(){this.pointer.stopSimulate()}});a.KinectBodyData=b}(EKjs||(EKjs={}));var EKjs;!function(a){"use strict";var b=null,c=null,d=a.Class.extend({constructor:function(){b=this},setDebugs:function(a){this._debugs=a},trackBodyOn:function(d,e,f,g){return b._selectedBody=new a.KinectBodyData,b._selectedBody.trackArea.x=d,b._selectedBody.trackArea.z=f,b._selectedBody.trackArea.dephX=e,b._selectedBody.trackArea.dephZ=g,c&&b._selectedBody.startSimulate(),b._selectedBody},getSelectedBody:function(){return b._selectedBody},getPixelPoint:function(a,c,d){d||(d=b._autoMultiplier);var e=c*d,f=.5*(e-c);return a*e-f},setFrameSize:function(a,b){this._frameWidth=a,this._frameHeight=b},start:function(a,b,c){this._bodyFrameReader=a.openReader(),this._bodyImageProcessor=KinectImageProcessor.BodyHelper,this._bodies=new Array(a.bodyCount),this._JointType=b,this._jointCount=c,this._bones=this._populateBones(),this._bodyFrameReader.addEventListener("framearrived",this._reader_BodyFrameArrived)},startSimulate:function(){c=!0,b._selectedBody&&b._selectedBody.startSimulate()},stopSimulate:function(){c=!1,b._selectedBody&&b._selectedBody.stopSimulate()},close:function(){this._bodyFrameReader&&this._bodyFrameReader.removeEventListener("framearrived",this._reader_BodyFrameArrived),this._bodyFrameReader=null},_bodyFrameReader:null,_bodyImageProcessor:null,_bodies:null,_bones:null,_JointType:null,_jointCount:null,_frameWidth:0,_frameHeight:0,_selectedBody:null,_debugs:null,_populateBones:function(){var a=new Array,b=window.WindowsPreview.Kinect.JointType;return a.push({jointStart:b.head,jointEnd:b.neck}),a.push({jointStart:b.neck,jointEnd:b.spineShoulder}),a.push({jointStart:b.spineShoulder,jointEnd:b.spineMid}),a.push({jointStart:b.spineMid,jointEnd:b.spineBase}),a.push({jointStart:b.spineShoulder,jointEnd:b.shoulderRight}),a.push({jointStart:b.spineShoulder,jointEnd:b.shoulderLeft}),a.push({jointStart:b.spineBase,jointEnd:b.hipRight}),a.push({jointStart:b.spineBase,jointEnd:b.hipLeft}),a.push({jointStart:b.shoulderRight,jointEnd:b.elbowRight}),a.push({jointStart:b.elbowRight,jointEnd:b.wristRight}),a.push({jointStart:b.wristRight,jointEnd:b.handRight}),a.push({jointStart:b.handRight,jointEnd:b.handTipRight}),a.push({jointStart:b.wristRight,jointEnd:b.thumbRight}),a.push({jointStart:b.shoulderLeft,jointEnd:b.elbowLeft}),a.push({jointStart:b.elbowLeft,jointEnd:b.wristLeft}),a.push({jointStart:b.wristLeft,jointEnd:b.handLeft}),a.push({jointStart:b.handLeft,jointEnd:b.handTipLeft}),a.push({jointStart:b.wristLeft,jointEnd:b.thumbLeft}),a.push({jointStart:b.hipRight,jointEnd:b.kneeRight}),a.push({jointStart:b.kneeRight,jointEnd:b.ankleRight}),a.push({jointStart:b.ankleRight,jointEnd:b.footRight}),a.push({jointStart:b.hipLeft,jointEnd:b.kneeLeft}),a.push({jointStart:b.kneeLeft,jointEnd:b.ankleLeft}),a.push({jointStart:b.ankleLeft,jointEnd:b.footLeft}),a},_targetSelectedBody:function(a){var b=!1;if(this._selectedBody&&this._selectedBody.trackArea){var c=window.WindowsPreview.Kinect.JointType,d=a[c.spineBase].position.x/this._frameWidth,e=a[c.spineBase].position.z,f=this._selectedBody.trackArea.x,g=this._selectedBody.trackArea.z,h=this._selectedBody.trackArea.dephX,i=this._selectedBody.trackArea.dephZ,j=f-h,k=f+h,l=g-i,m=g+i;d>j&&k>d&&e>l&&m>e&&(b=!0)}return b},_populateBodyDatas:function(a,c,d){if(b._selectedBody){b._selectedBody.id=c;var e=d[b._JointType.spineBase].position.y-d[b._JointType.head].position.y,f=b._selectedBody.trackArea.handPushZ;b._selectedBody.pointMultiplier=1/(e/b._frameHeight)*1.5;var g=d[b._JointType.handLeft].position,h=d[b._JointType.handRight].position,i=d[b._JointType.head].position;h.y<d[b._JointType.spineBase].position.y&&i.z-h.z>f?(b._selectedBody.rightHandClosed=a.handRightState==WindowsPreview.Kinect.HandState.closed,b._selectedBody.rightHandOpen=a.handRightState==WindowsPreview.Kinect.HandState.open,b._fillRawBodyPoint(b._selectedBody.rightHand,h),b._selectedBody.handRightTracked=!0):b._selectedBody.handRightTracked=!1,g.y<d[b._JointType.spineBase].position.y&&i.z-g.z>f?(b._selectedBody.leftHandClosed=a.handLeftState==WindowsPreview.Kinect.HandState.closed,b._selectedBody.leftHandOpen=a.handLeftState==WindowsPreview.Kinect.HandState.open,b._fillRawBodyPoint(b._selectedBody.leftHand,g),b._selectedBody.handLeftTracked=!0):b._selectedBody.handLeftTracked=!1,b._fillRawBodyPoint(b._selectedBody.head,i),b._fillRawBodyPoint(b._selectedBody.neck,d[b._JointType.neck]),b._fillRawBodyPoint(b._selectedBody.spineShoulder,d[b._JointType.spineShoulder]),b._fillRawBodyPoint(b._selectedBody.spineMid,d[b._JointType.spineMid]),b._fillRawBodyPoint(b._selectedBody.spineBase,d[b._JointType.spineBase]),b._fillRawBodyPoint(b._selectedBody.shoulderRight,d[b._JointType.shoulderRight]),b._fillRawBodyPoint(b._selectedBody.elbowRight,d[b._JointType.elbowRight]),b._fillRawBodyPoint(b._selectedBody.wristRight,d[b._JointType.wristRight]),b._fillRawBodyPoint(b._selectedBody.handTipRight,d[b._JointType.handTipRight]),b._fillRawBodyPoint(b._selectedBody.handTipLeft,d[b._JointType.handTipLeft]),b._fillRawBodyPoint(b._selectedBody.thumbRight,d[b._JointType.thumbRight]),b._fillRawBodyPoint(b._selectedBody.shoulderLeft,d[b._JointType.shoulderLeft]),b._fillRawBodyPoint(b._selectedBody.elbowLeft,d[b._JointType.elbowLeft]),b._fillRawBodyPoint(b._selectedBody.thumbLeft,d[b._JointType.thumbLeft]),b._fillRawBodyPoint(b._selectedBody.wristLeft,d[b._JointType.wristLeft]),b._fillRawBodyPoint(b._selectedBody.hipRight,d[b._JointType.hipRight]),b._fillRawBodyPoint(b._selectedBody.kneeRight,d[b._JointType.kneeRight]),b._fillRawBodyPoint(b._selectedBody.ankleRight,d[b._JointType.ankleRight]),b._fillRawBodyPoint(b._selectedBody.footRight,d[b._JointType.footRight]),b._fillRawBodyPoint(b._selectedBody.hipLeft,d[b._JointType.hipLeft]),b._fillRawBodyPoint(b._selectedBody.kneeLeft,d[b._JointType.kneeLeft]),b._fillRawBodyPoint(b._selectedBody.ankleLeft,d[b._JointType.ankleLeft]),b._fillRawBodyPoint(b._selectedBody.footLeft,d[b._JointType.footLeft]),b._selectedBody.isTracked=!0,b._selectedBody.render()}},_fillRawBodyPoint:function(a,c){a.x=c.x/b._frameWidth,a.y=c.y/b._frameHeight,a.z=c.z},_createJointPoints:function(){for(var a=new Array,b=0;b<this._jointCount;++b)a.push({joint:0,x:.5,y:.5,z:0});return a},_reader_BodyFrameArrived:function(a){var c=a.frameReference.acquireFrame(),d=!1;if(null!=c&&(c.getAndRefreshBodyData(b._bodies),d=!0,c.close()),d){if(b._debugs)for(var e in b._debugs)b._debugs[e].disabledClear||b._debugs[e].clearCanvas();for(var f=0;f<b._bodies.length;++f){var g=b._bodies[f];if(g.isTracked){var h=g.joints,i=b._createJointPoints();if(b._bodyImageProcessor.processJointLocations(h,i)){var j=b._targetSelectedBody(i);if(j&&b._populateBodyDatas(g,f,i),b._debugs)for(var e in b._debugs)(!b._debugs[e].onlySelected||j)&&b._debugs[e].drawBody(g,i,f,g.clippedEdges,b._bones)}}}}}});a.KinectBodyFrame=d}(EKjs||(EKjs={}));var EKjs;!function(a){"use strict";var b=20,c=4,d=1,e=3,f=5,g="red",h="green",i="blue",j="green",k="yellow",l=a.Class.extend({constructor:function(a){this.id=a,this._bodyCanvas=document.getElementById(a),this._bodyContext=this._bodyCanvas.getContext("2d"),this._bodyColors=["#FF4611","#3A5CAC","#8CB7E8","#FFB718","#DC0031","#00ADBB"]},id:null,onlySelected:!1,disabledClear:!1,setSize:function(a,b){this._bodyCanvas.width=a,this._bodyCanvas.height=b},clearCanvas:function(){this._bodyContext.clearRect(0,0,this._bodyCanvas.width,this._bodyCanvas.height)},drawBody:function(a,b,c,d,e){this._drawBodyJoints(a.joints,b,this._bodyColors[c],e),this._updateHandState(a.handLeftState,b[window.WindowsPreview.Kinect.JointType.handLeft]),this._updateHandState(a.handRightState,b[window.WindowsPreview.Kinect.JointType.handRight]),this._drawClippedEdges(d)},_bodyCanvas:null,_bodyContext:null,_bodyColors:null,_jointCount:null,_drawBodyJoints:function(a,b,e,f){for(var g=f.length,h=0;g>h;++h){var i=f[h].jointStart,l=f[h].jointEnd,m=a.lookup(i),n=a.lookup(l);if(m.trackingState==window.WindowsPreview.Kinect.TrackingState.notTracked||n.trackingState==window.WindowsPreview.Kinect.TrackingState.notTracked)return;var o=d;m.trackingState==window.WindowsPreview.Kinect.TrackingState.tracked&&n.trackingState==window.WindowsPreview.Kinect.TrackingState.tracked&&(o=c),this._drawBone(b[i],b[l],o,e)}for(var p=null,q=0;q<this._jointCount;++q){var r=a.lookup(q).trackingState;r==kinect.TrackingState.tracked?p=j:r==kinect.TrackingState.inferred&&(p=k),null!=p&&this._drawJoint(b[q],p)}},_drawHand:function(a,c){this._bodyContext.globalAlpha=.75,this._bodyContext.beginPath(),this._bodyContext.fillStyle=c,this._bodyContext.arc(a.x,a.y,b,0,2*Math.PI,!0),this._bodyContext.fill(),this._bodyContext.closePath(),this._bodyContext.globalAlpha=1},_drawJoint:function(a,b){this._bodyContext.beginPath(),this._bodyContext.fillStyle=b,this._bodyContext.arc(a.position.x,a.position.y,e,0,2*Math.PI,!0),this._bodyContext.fill(),this._bodyContext.closePath()},_drawBone:function(a,b,c,d){this._bodyContext.beginPath(),this._bodyContext.strokeStyle=d,this._bodyContext.lineWidth=c,this._bodyContext.moveTo(a.position.x,a.position.y),this._bodyContext.lineTo(b.position.x,b.position.y),this._bodyContext.stroke(),this._bodyContext.closePath()},_updateHandState:function(a,b){switch(a){case window.WindowsPreview.Kinect.HandState.closed:this._drawHand(b,g);break;case window.WindowsPreview.Kinect.HandState.open:this._drawHand(b,h);break;case window.WindowsPreview.Kinect.HandState.lasso:this._drawHand(b,i)}},_drawClippedEdges:function(a){this._bodyContext.fillStyle="red",this._hasClippedEdges(a,window.WindowsPreview.Kinect.FrameEdges.bottom)&&this._bodyContext.fillRect(0,this._bodyCanvas.height-f,this._bodyCanvas.width,f),this._hasClippedEdges(a,window.WindowsPreview.Kinect.FrameEdges.top)&&this._bodyContext.fillRect(0,0,this._bodyCanvas.width,f),this._hasClippedEdges(a,window.WindowsPreview.Kinect.FrameEdges.left)&&this._bodyContext.fillRect(0,0,f,this._bodyCanvas.height),this._hasClippedEdges(a,window.WindowsPreview.Kinect.FrameEdges.right)&&this._bodyContext.fillRect(this._bodyCanvas.width-f,0,f,this._bodyCanvas.height)},_hasClippedEdges:function(a,b){return 0!=(a&b)}});a.KinectDebug=l}(EKjs||(EKjs={}));var EKjs;!function(a){"use strict";var b=10,c=60,d=0,e=0,f=a.Class.extend({constructor:function(a){this._body=a},name:"",x:0,y:0,z:0,appWidth:window.innerWidth,appHeight:window.innerHeight,addEventListener:function(b,c,d,e){var f=this._getTargetId(d),g=this._getListernersId(f,c),h=!1;e&&(h=e.handClosed),this._targets[f]={target:d,isOver:!1,isHold:!1,forceHandClosed:h,holdComplete:!1};var i={targetId:f,funct:c};switch(b){case a.Kinect.Events.Pointer.MOVE:this._funcsMove[g]=i;break;case a.Kinect.Events.Pointer.OVER:this._funcsOver[g]=i;break;case a.Kinect.Events.Pointer.OUT:this._funcsOut[g]=i;break;case a.Kinect.Events.Pointer.UP:this._funcsUp[g]=i;break;case a.Kinect.Events.Pointer.DOWN:this._funcsDown[g]=i;break;case a.Kinect.Events.Pointer.HOLD_START:this._funcsHoldStart[g]=i;break;case a.Kinect.Events.Pointer.HOLD_PROGRESS:this._funcsHoldProgress[g]=i;break;case a.Kinect.Events.Pointer.HOLD_END:this._funcsHoldEnd[g]=i}},removeEventListener:function(b,c,d){var e=this._getTargetId(d),f=this._getListernersId(e,c);switch(this._targets[e]&&(this._targets[e]=null),b){case a.Kinect.Events.Pointer.MOVE:this._funcsMove[f]=null;break;case a.Kinect.Events.Pointer.OVER:this._funcsOver[f]=null;break;case a.Kinect.Events.Pointer.OUT:this._funcsOut[f]=null;break;case a.Kinect.Events.Pointer.UP:this._funcsUp[f]=null;break;case a.Kinect.Events.Pointer.DOWN:this._funcsDown[f]=null;break;case a.Kinect.Events.Pointer.HOLD_START:this._funcsHoldStart[f]=null;break;case a.Kinect.Events.Pointer.HOLD_PROGRESS:this._funcsHoldProgress[f]=null;break;case a.Kinect.Events.Pointer.HOLD_END:this._funcsHoldEnd[f]=null}},render:function(){var b=this._body.handLeftTracked||this._body.handRightTracked,c=!1,d=!1;this._body.isTracked&&(b?(this._body.handRightTracked&&this._body.rightHand.z<this._body.leftHand.z?(c=this._body.rightHandClosed,d=this._body.rightHandOpen,this.x=a.Kinect.multiplyPixelPoint(this._body.rightHand.x,this.appWidth,this._body.pointMultiplier),this.y=a.Kinect.multiplyPixelPoint(this._body.rightHand.y,this.appHeight,this._body.pointMultiplier),b=!0):this._body.handLeftTracked&&(c=this._body.leftHandClosed,d=this._body.leftHandOpen,this.x=a.Kinect.multiplyPixelPoint(this._body.leftHand.x,this.appWidth,this._body.pointMultiplier),this.y=a.Kinect.multiplyPixelPoint(this._body.leftHand.y,this.appHeight,this._body.pointMultiplier),b=!0),c&&!this._isDown?(this._renderDownCallbacks(),this._isDown=!0):d&&this._isDown&&(this._renderUpCallbacks(),this._isDown=!1),this._userActive||(this._userActive=!0)):this._userActive&&(this._userActive=!1,this._renderUpCallbacks(),this._isDown=!1),this._renderHoldCallbacks(c),this._renderOverOutCallbacks(),this._renderMoveCallbacks())},startSimulate:function(){function a(a){c.x=a.clientX+(window.scrollX?window.scrollX:document.documentElement.scrollLeft),c.y=a.clientY+(window.scrollY?window.scrollY:document.documentElement.scrollTop)}function b(){c._renderHoldCallbacks(c._isDown),window.requestAnimationFrame(b)}var c=this;c._userActive=!1,document.addEventListener("mousedown",function(b){c._isDown=!0,a(b),c._renderDownCallbacks()}),document.addEventListener("mouseup",function(b){c._isDown=!1,a(b),c._renderUpCallbacks()}),document.addEventListener("mousemove",function(d){a(d),c._renderMoveCallbacks(),c._renderOverOutCallbacks(),c._userActive||(b(),c._userActive=!0)}),document.addEventListener("mousewheel",function(a){c.z+=a.wheelDelta,c._renderMoveCallbacks()})},stopSimulate:function(){window.cancelAnimationFrame(this.startSimulate)},_body:null,_funcsMove:{},_funcsOver:{},_funcsOut:{},_funcsUp:{},_funcsDown:{},_funcsHoldStart:{},_funcsHoldProgress:{},_funcsHoldEnd:{},_targets:{},_isDown:!1,_userActive:!1,_getTargetId:function(a,b){var c="";return a.id&&""!=a.id?c=a.id:a.className&&(c=a.className),c},_getListernersId:function(a,b){var c=a+b.toString();return c},_getRectangle:function(a){var b={},c=a.getBoundingClientRect();return b.width=c.width,b.height=c.height,b.x=c.left,b.y=c.top,b},_isOverTarget:function(a){return this._targets[a]&&this._checkIfIsOver(this._targets[a].target)},_checkIfIsOver:function(a){var b,c=!1;return b=a.width&&a.x?a:this._getRectangle(a),this.x>b.x&&this.x<b.x+b.width&&this.y>b.y&&this.y<b.y+b.height&&(c=!0),c},_renderHoldCallbacks:function(a){for(var f in this._funcsHoldStart)if(null!=this._funcsHoldStart[f]){var g=this._funcsHoldStart[f].targetId;this._isOverTarget(g)?this._handIsClosedOnTarget(g,a)&&(this._targets[g].isHold||(b>e?e++:(e=0,d=0,this._targets[g].isHold=!0,this._funcsHoldStart[f]&&this._funcsHoldStart[f].funct(this._targets[g].target,d/c)))):this._targets[g]&&this._targets[g].isHold&&(e=0,d=0,this._targets[g].holdComplete=!1,this._targets[g].isHold=!1)}for(var f in this._funcsHoldProgress){var g=this._funcsHoldProgress[f].targetId;this._isOverTarget(g)&&this._targets[g].isHold&&this._handIsClosedOnTarget(g,a)&&c>d&&(d++,this._funcsHoldProgress[f]&&this._funcsHoldProgress[f].funct(this._targets[g].target,d/c))}for(var f in this._funcsHoldEnd){var g=this._funcsHoldEnd[f].targetId;this._isOverTarget(g)&&this._targets[g].isHold&&!this._handIsClosedOnTarget(g,a)&&d>=c&&(d=0,this._targets[g].holdComplete=!0,this._targets[g].isHold=!1,this._funcsHoldEnd[f]&&this._funcsHoldEnd[f].funct(this._targets[g].target,1))}},_renderOverOutCallbacks:function(){var a=!1;for(var b in this._funcsOver)if(null!=this._funcsOver[b]){var c=this._funcsOver[b].targetId;this._targets[c]&&(a=this._checkIfIsOver(this._targets[c].target),!this._targets[c].isOver&&a&&(this._targets[c].isOver=!0,this._funcsOver[b].funct(this._targets[c].target)))}for(var b in this._funcsOut)if(null!=this._funcsOut[b]){var c=this._funcsOut[b].targetId;this._targets[c]&&(a=this._checkIfIsOver(this._targets[c].target),this._targets[c].isOver&&!a&&(this._targets[c].isOver=!1,this._funcsOut[b].funct(this._targets[c].target)))}},_renderMoveCallbacks:function(){this._callListenersOnTarget(this._funcsMove)},_renderUpCallbacks:function(){this._callListenersOnTarget(this._funcsUp)},_renderDownCallbacks:function(){this._callListenersOnTarget(this._funcsDown)},_callListenersOnTarget:function(a){for(var b in a)if(null!=a[b]){var c=a[b].targetId;this._targets[c]&&(!this._targets[c].target||this._targets[c].target&&this._checkIfIsOver(this._targets[c].target))&&a[b].funct(this._targets[c].target)}},_handIsClosedOnTarget:function(a,b){return this._targets[a]&&(!this._targets[a].forceHandClosed||b)&&!this._targets[a].holdComplete}});a.KinectPointer=f}(EKjs||(EKjs={}));var EKjs;!function(a){"use strict";var b=null,c=a.Class.extend({constructor:function(c,d,e,f){e=e?e:.2,f=f?f:.5,this._body=c,b=this,this._dragHelper=new a.DragHelper(e,f),this._body&&this._body.pointer&&(this._body.pointer.addEventListener(a.Kinect.Events.Pointer.MOVE,this._getMousePosition,document.body),this._body.pointer.addEventListener(a.Kinect.Events.Pointer.UP,this._onUpHandler,document.body),this._body.pointer.addEventListener(a.Kinect.Events.Pointer.DOWN,this._onDownHandler,d))},x:0,y:0,z:0,rotateX:0,rotateY:0,rotateZ:0,update:function(){b._dragHelper.needUpdate&&(b._dragHelper.updateDrag(b._pointerX,b._pointerY,b._pointerZ),b.x=b._dragHelper.x,b.y=b._dragHelper.y,b.z=b._dragHelper.z,b.rotateX=-b._dragHelper.y%360,b.rotateY=b._dragHelper.x%360,b.rotateZ=b._dragHelper.z%360)},setLimitY:function(a,b){this._dragHelper.minY=a,this._dragHelper.maxY=b},setLimitX:function(a,b){this._dragHelper.minX=a,this._dragHelper.maxX=b},setLimitZ:function(a,b){this._dragHelper.minZ=a,this._dragHelper.maxZ=b},setInitX:function(a){this._dragHelper.x=this._dragHelper._endX=a},setInitY:function(a){this._dragHelper.initY=this._dragHelper._endY=a},isRefresh:function(){return this._dragHelper.needUpdate},_dragHelper:null,_pointerX:0,_pointerY:0,_pointerZ:0,_body:null,_getMousePosition:function(a){b._pointerX=b._body.pointer.x,b._pointerY=b._body.pointer.y,b._pointerZ=b._body.pointer.z},_onDownHandler:function(a){b._pointerX=b._body.pointer.x,b._pointerY=b._body.pointer.y,b._pointerZ=b._body.pointer.z,b._dragHelper.startDrag(b._pointerX,b._pointerY,b._pointerZ)},_onUpHandler:function(){b._dragHelper.stopDrag()}});a.DragController=c}(EKjs||(EKjs={}));var EKjs;!function(a){"use strict";var b=null,c=a.Class.extend({constructor:function(a,c){b=this,b.velocity=a?a:.2,b.sensibilityRatio=c?c:.5},velocity:0,sensibilityRatio:0,isDrag:!1,needUpdate:!1,x:0,y:0,z:0,minX:NaN,minY:NaN,minZ:NaN,maxY:NaN,maxX:NaN,maxZ:NaN,_dragX:0,_dragY:0,_dragZ:0,_startX:0,_endX:0,_startY:0,_endY:0,_startZ:0,_endZ:0,_endVelocityCallback:null,_saveVelocityValue:0,startDrag:function(a,c,d){b.isDrag=!0,b.needUpdate=!0,b._startX=a*b.sensibilityRatio+b._endX,b._startY=c*b.sensibilityRatio+b._endY,b._startZ=d*b.sensibilityRatio+b._endZ},stopDrag:function(a){b.isDrag&&(b.isDrag=!1,b._endX=b._dragX,b._endY=b._dragY,b._endZ=b._dragZ,b._endVelocityCallback=a)},updateDrag:function(a,c,d){b.isDrag&&(b._dragX=b._startX-a*b.sensibilityRatio,b._dragY=b._startY-c*b.sensibilityRatio,b._dragZ=b._startZ-d*b.sensibilityRatio,!isNaN(b.minY)&&b._dragY<b.minY&&(b._dragY=b.minY),!isNaN(b.maxY)&&b._dragY>b.maxY&&(b._dragY=b.maxY),!isNaN(b.minX)&&b._dragX<b.minX&&(b._dragX=b.minX),!isNaN(b.maxX)&&b._dragX>b.maxX&&(b._dragX=b.maxX),!isNaN(b.minZ)&&b._dragZ<b.minZ&&(b._dragZ=b.minZ),!isNaN(b.maxZ)&&b._dragZ>b.maxZ&&(b._dragZ=b.maxZ)),Math.abs(b.x-b._dragX)<1&&Math.abs(b.y-b._dragY)<1&&Math.abs(b.z-b._dragZ)<1?b.isDrag||(null!=b._endVelocityCallback&&b._endVelocityCallback(),b._endVelocityCallback=null,b.needUpdate=!1,b._dragX=0,b._dragY=0,b._dragZ=0,b._startX=0,b._startY=0,b._startZ=0):(b.x+=(b._dragX-b.x)*b.velocity,b.y+=(b._dragY-b.y)*b.velocity,b.z+=(b._dragZ-b.z)*b.velocity)},_name:"",_render:function(){}});a.DragHelper=c}(EKjs||(EKjs={}));